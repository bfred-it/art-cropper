(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./app/scripts/main.js":[function(require,module,exports){"use strict";var onDrop=require("drag-and-drop-files");var cutil=require("./_modules/canvas-utils.js");var fillCanvas=require("./_modules/canvas-draw-image-fill.js");var getImage=require("./_modules/image-loader.js");var saveAs=require("./_modules/save-file.js").saveAs;var select=require("./_modules/dom-select.js");var pica=require("pica");var dragging=false;var ondragend=function(){};document.documentElement.onmouseup=function(){dragging=false;if(ondragend){ondragend();ondragend=null}};function draw(ctx,image,opts){var t=fillCanvas.getTransforms(ctx,image,opts);var width=image.width*t.scale;var height=image.height*t.scale;var scratch=cutil.getCanvas(width,height).el;pica.resizeCanvas(cutil.getCanvasFromImage(image),scratch,{quality:3},function(){ctx.drawImage(scratch,t.in.x*t.scale,t.in.y*t.scale,t.in.w*t.scale,t.in.h*t.scale,t.out.x,t.out.y,t.out.w,t.out.h)})}var lastEvent;function createInteractiveCanvas(image,width,height,name){var canvas=cutil.getCanvas(width,height);draw(canvas.ctx,image);select.byId("images").appendChild(canvas.el);var deltaX=0;var deltaY=0;canvas.el.onmousedown=function(){dragging=true};canvas.el.onmousemove=function(e){if(!dragging){return}if(lastEvent){deltaX+=e.screenX-lastEvent.screenX;deltaY+=e.screenY-lastEvent.screenY}lastEvent=e;fillCanvas(canvas.ctx,image,{offsetX:deltaX,offsetY:deltaY});ondragend=function(){lastEvent=null;draw(canvas.ctx,image,{offsetX:deltaX,offsetY:deltaY})}};canvas.el.__name=name;return canvas}var counter=select.byId("counter");var configEl=select.byId("config");onDrop(document.documentElement,function(files){var config=configEl.value.split(";").map(function(current){current=current.split(",");var size=current[0].split("x");return{width:size[0],height:size[1],filename:current[1]}});files.forEach(function(file){getImage(URL.createObjectURL(file),function(){var file=this;config.forEach(function(image){createInteractiveCanvas(file,image.width,image.height,image.filename.replace(/#/g,counter.value))});counter.value=+counter.value+1},true)})});window.onload=function(){select.byId("save").onclick=function(){select.all("canvas").forEach(function(canvas){canvas.toBlob(function(blob){saveAs(blob,canvas.__name+".png")})})};select.byId("reset").onclick=function(){select.all("canvas").forEach(function(canvas){canvas.parentNode.removeChild(canvas)})}}},{"./_modules/canvas-draw-image-fill.js":"/Users/bfred/Web/projects/cropper/app/scripts/_modules/canvas-draw-image-fill.js","./_modules/canvas-utils.js":"/Users/bfred/Web/projects/cropper/app/scripts/_modules/canvas-utils.js","./_modules/dom-select.js":"/Users/bfred/Web/projects/cropper/app/scripts/_modules/dom-select.js","./_modules/image-loader.js":"/Users/bfred/Web/projects/cropper/app/scripts/_modules/image-loader.js","./_modules/save-file.js":"/Users/bfred/Web/projects/cropper/app/scripts/_modules/save-file.js","drag-and-drop-files":"/Users/bfred/Web/projects/cropper/node_modules/drag-and-drop-files/ondrop.js",pica:"/Users/bfred/Web/projects/cropper/node_modules/pica/index.js"}],"/Users/bfred/Web/projects/cropper/app/scripts/_modules/canvas-draw-image-fill.js":[function(require,module,exports){"use strict";function getTransforms(ctx,source,opts){opts=opts||{};var x=opts.x||0;var y=opts.y||0;var w=opts.w||ctx.canvas.width;var h=opts.h||ctx.canvas.height;var offsetX=opts.offsetX||0;var offsetY=opts.offsetY||0;var origWidth=opts.origWidth||source.width||source.videoWidth;var origHeight=opts.origHeight||source.height||source.videoHeight;if(!origWidth||!origHeight){console.log("Width or height not available",origWidth,origHeight)}if(ctx.__storedScale>1){w/=ctx.__storedScale;h/=ctx.__storedScale}var scale;var sourceX=0;var sourceY=0;var sourceWidth=origWidth;var sourceHeight=origHeight;var sourceRatio=origHeight/origWidth;var destinationRatio=h/w;var isDestinationLandscape=h<w;var maxOffsetDeltaX=0;var maxOffsetDeltaY=0;if(sourceRatio<destinationRatio){scale=h/sourceHeight;maxOffsetDeltaX=Math.abs(w-sourceWidth*scale);sourceWidth=sourceHeight/destinationRatio;sourceX=(origWidth-sourceWidth)/2}else{scale=w/sourceWidth;maxOffsetDeltaY=Math.abs(h-sourceHeight*scale);if(isDestinationLandscape){sourceHeight=sourceWidth*destinationRatio}else{sourceHeight=sourceWidth/destinationRatio}sourceY=(origHeight-sourceHeight)/2}offsetX=Math.max(-maxOffsetDeltaX,Math.min(maxOffsetDeltaX,offsetX/scale));offsetY=Math.max(-maxOffsetDeltaY,Math.min(maxOffsetDeltaY,offsetY/scale));sourceX-=offsetX;sourceY-=offsetY;return{scale:scale,offset:{x:offsetX,y:offsetY},"in":{x:sourceX,y:sourceY,w:sourceWidth,h:sourceHeight},out:{x:x,y:y,w:w,h:h}}}function drawImageFromTransforms(ctx,source,t){ctx.drawImage(source,t.in.x,t.in.y,t.in.w,t.in.h,t.out.x,t.out.y,t.out.w,t.out.h)}function drawImageFillArea(ctx,source,opts){drawImageFromTransforms(ctx,source,getTransforms(ctx,source,opts))}module.exports=drawImageFillArea;module.exports.getTransforms=getTransforms;module.exports.drawImageFromTransforms=drawImageFromTransforms},{}],"/Users/bfred/Web/projects/cropper/app/scripts/_modules/canvas-utils.js":[function(require,module,exports){"use strict";function getCanvas(w,h){var canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");if(w){canvas.width=w}if(h){canvas.height=h}return{el:canvas,ctx:ctx}}function getCanvasFromImage(img,type){var canvas=getCanvas(img.width,img.height);canvas.ctx.drawImage(img,0,0,img.width,img.height);if(type==="ctx"){return canvas.ctx}return canvas.el}function drawImageFillArea(ctx,source,x,y,w,h,origWidth,origHeight){origWidth=origWidth||source.width||source.videoWidth;origHeight=origHeight||source.height||source.videoHeight;if(!origWidth||!origHeight){console.log("Width or height available",origWidth,origHeight)}var sourceX=0;var sourceY=0;var sourceWidth=origWidth;var sourceHeight=origHeight;var sourceRatio=origHeight/origWidth;var destinationRatio=h/w;var isDestinationLandscape=h<w;if(sourceRatio<destinationRatio){if(isDestinationLandscape){sourceWidth=sourceHeight*destinationRatio}else{sourceWidth=sourceHeight/destinationRatio}sourceX=(origWidth-sourceWidth)/2}else{if(isDestinationLandscape){sourceHeight=sourceWidth*destinationRatio}else{sourceHeight=sourceWidth/destinationRatio}sourceY=(origHeight-sourceHeight)/2}console.log(sourceX,sourceY,sourceWidth,sourceHeight);ctx.drawImage(source,sourceX,sourceY,sourceWidth,sourceHeight,x,y,w,h)}function fillAreaWithImageAndGetSrc(source,w,h,origWidth,origHeight){var canvas=getCanvas(w,h);drawImageFillArea(canvas.ctx,source,0,0,w,h,origWidth,origHeight);return canvas.el.toDataURL()}function cropImageAndGetSrc(source,x,y,width,height){var canvas=getCanvas(width,height);canvas.ctx.drawImage(source,x,y);return canvas.el.toDataURL()}function getTrimmedImageCoordinates(image){var width=image.width;var height=image.height;var canvas=getCanvasFromImage(image);var ctx=canvas.getContext("2d");var imageData=ctx.getImageData(0,0,width,height);var data=imageData.data;var x,y,alpha,pos=0;var a={x:width,y:height};var b={x:0,y:0};var count=0;for(y=0;y<height;y++){for(x=0;x<width;x++){alpha=data[pos+3];if(alpha){if(count<500){count++}if(x<a.x){a.x=x}if(y<a.y){a.y=y}if(x>b.x){b.x=x}if(y>b.y){b.y=y}}pos+=4}}return{a:a,b:b,y:a.y,x:a.x,width:b.x-a.x+1,height:b.y-a.y+1}}exports.getCanvas=getCanvas;exports.fillAreaWithImageAndGetSrc=fillAreaWithImageAndGetSrc;exports.cropImageAndGetSrc=cropImageAndGetSrc;exports.drawImageFillArea=drawImageFillArea;exports.getCanvasFromImage=getCanvasFromImage;exports.getTrimmedImageCoordinates=getTrimmedImageCoordinates},{}],"/Users/bfred/Web/projects/cropper/app/scripts/_modules/dom-select.js":[function(require,module,exports){"use strict";var select=function(selector,container){container=container||document;return container.querySelector(selector)};select.all=function(selector,container){container=container||document;return Array.prototype.slice.call(container.querySelectorAll(selector))};select.byClass=function(className,container){container=container||document;return Array.prototype.slice.call(container.getElementsByClassName(className))};select.byId=function(id,container){container=container||document;return container.getElementById(id)};module.exports=select},{}],"/Users/bfred/Web/projects/cropper/app/scripts/_modules/image-loader.js":[function(require,module,exports){"use strict";var EMPTY_IMAGE="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";var images=[];var willVerifyAll=false;var loaded={};function verifyAll(){willVerifyAll=false;for(var i=0;i<images.length;i++){if(images[i].complete){images[i]._loadCallback()}}images.length=0}function verifyAsap(image){images.push(image);if(!willVerifyAll){willVerifyAll=true;setTimeout(verifyAll,0)}}function _loadCallback(){var img=this;if(img._wasLoaded){return}img._wasLoaded=true;img._loadCallbackUser();if(img._willBeReused){loaded[img.src]=img}else{img.src=EMPTY_IMAGE}}function loadImage(src,userCallback,get){if(get&&loaded[src]){setTimeout(userCallback.bind(loaded[src]),0);return loaded[src]}var image=new Image;if(userCallback){image._wasLoaded=false;image._willBeReused=get;image._loadCallbackUser=userCallback;image._loadCallback=_loadCallback;image.onload=image._loadCallback;image.onerror=image._loadCallback;verifyAsap(image)}image.src=src;if(get){return image}}module.exports=loadImage},{}],"/Users/bfred/Web/projects/cropper/app/scripts/_modules/save-file.js":[function(require,module,exports){(function(view){"use strict";var Uint8Array=view.Uint8Array,HTMLCanvasElement=view.HTMLCanvasElement,canvas_proto=HTMLCanvasElement&&HTMLCanvasElement.prototype,is_base64_regex=/\s*;\s*base64\s*(?:;|$)/i,to_data_url="toDataURL",base64_ranks,decode_base64=function(base64){var len=base64.length,buffer=new Uint8Array(len/4*3|0),i=0,outptr=0,last=[0,0],state=0,save=0,rank,code,undef;while(len--){code=base64.charCodeAt(i++);rank=base64_ranks[code-43];if(rank!==255&&rank!==undef){last[1]=last[0];last[0]=code;save=save<<6|rank;state++;if(state===4){buffer[outptr++]=save>>>16;if(last[1]!==61){buffer[outptr++]=save>>>8}if(last[0]!==61){buffer[outptr++]=save}state=0}}}return buffer};if(Uint8Array){base64_ranks=new Uint8Array([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])}if(HTMLCanvasElement&&!canvas_proto.toBlob){canvas_proto.toBlob=function(callback,type){if(!type){type="image/png"}if(this.mozGetAsFile){callback(this.mozGetAsFile("canvas",type));return}if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(type)){callback(this.msToBlob());return}var args=Array.prototype.slice.call(arguments,1),dataURI=this[to_data_url].apply(this,args),header_end=dataURI.indexOf(","),data=dataURI.substring(header_end+1),is_base64=is_base64_regex.test(dataURI.substring(0,header_end)),blob;if(Blob.fake){blob=new Blob;if(is_base64){blob.encoding="base64"}else{blob.encoding="URI"}blob.data=data;blob.size=data.length}else if(Uint8Array){if(is_base64){blob=new Blob([decode_base64(data)],{type:type})}else{blob=new Blob([decodeURIComponent(data)],{type:type})}}callback(blob)};if(canvas_proto.toDataURLHD){canvas_proto.toBlobHD=function(){to_data_url="toDataURLHD";var blob=this.toBlob();to_data_url="toDataURL";return blob}}else{canvas_proto.toBlobHD=canvas_proto.toBlob}}})(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content||this);var saveAs=saveAs||typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(view){"use strict";if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var doc=view.document,get_URL=function(){return view.URL||view.webkitURL||view},save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link="download"in save_link,click=function(node){var event=doc.createEvent("MouseEvents");event.initMouseEvent("click",true,false,view,0,0,0,0,0,false,false,false,false,0,null);node.dispatchEvent(event)},webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex},0)},force_saveable_type="application/octet-stream",fs_min_size=0,arbitrary_revoke_timeout=500,revoke=function(file){var revoker=function(){if(typeof file==="string"){get_URL().revokeObjectURL(file)}else{file.remove()}};if(view.chrome){revoker()}else{setTimeout(revoker,arbitrary_revoke_timeout)}},dispatch=function(filesaver,event_types,event){event_types=[].concat(event_types);var i=event_types.length;while(i--){var listener=filesaver["on"+event_types[i]];if(typeof listener==="function"){try{listener.call(filesaver,event||filesaver)}catch(ex){throw_outside(ex)}}}},FileSaver=function(blob,name){var filesaver=this,type=blob.type,blob_changed=false,object_url,target_view,dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "))},fs_error=function(){if(blob_changed||!object_url){object_url=get_URL().createObjectURL(blob)}if(target_view){target_view.location.href=object_url}else{var new_tab=view.open(object_url,"_blank");if(new_tab==undefined&&typeof safari!=="undefined"){view.location.href=object_url}}filesaver.readyState=filesaver.DONE;dispatch_all();revoke(object_url)},abortable=function(func){return function(){if(filesaver.readyState!==filesaver.DONE){return func.apply(this,arguments)}}},create_if_not_found={create:true,exclusive:false},slice;filesaver.readyState=filesaver.INIT;if(!name){name="download"}if(can_use_save_link){object_url=get_URL().createObjectURL(blob);save_link.href=object_url;save_link.download=name;click(save_link);filesaver.readyState=filesaver.DONE;dispatch_all();revoke(object_url);return}if(/^\s*(?:text\/(?:plain|xml)|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)){blob=new Blob(["\ufeff",blob],{type:blob.type})}if(view.chrome&&type&&type!==force_saveable_type){slice=blob.slice||blob.webkitSlice;blob=slice.call(blob,0,blob.size,force_saveable_type);blob_changed=true}if(webkit_req_fs&&name!=="download"){name+=".download"}if(type===force_saveable_type||webkit_req_fs){target_view=view}if(!req_fs){fs_error();return}fs_min_size+=blob.size;req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL();filesaver.readyState=filesaver.DONE;dispatch(filesaver,"writeend",event);revoke(file)};writer.onerror=function(){var error=writer.error;if(error.code!==error.ABORT_ERR){fs_error()}};"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event]});writer.write(blob);filesaver.abort=function(){writer.abort();filesaver.readyState=filesaver.DONE};filesaver.readyState=filesaver.WRITING}),fs_error)}),fs_error)};dir.getFile(name,{create:false},abortable(function(file){file.remove();save()}),abortable(function(ex){if(ex.code===ex.NOT_FOUND_ERR){save()}else{fs_error()}}))}),fs_error)}),fs_error)},FS_proto=FileSaver.prototype,saveAs=function(blob,name){return new FileSaver(blob,name)};FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE;dispatch(filesaver,"abort")};FS_proto.readyState=FS_proto.INIT=0;FS_proto.WRITING=1;FS_proto.DONE=2;FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null;return saveAs}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module.exports){module.exports.saveAs=saveAs}else if(typeof define!=="undefined"&&define!==null&&define.amd!=null){define([],function(){return saveAs})}},{}],"/Users/bfred/Web/projects/cropper/node_modules/drag-and-drop-files/ondrop.js":[function(require,module,exports){"use strict";function handleDrop(callback,event){event.stopPropagation();event.preventDefault();callback(Array.prototype.slice.call(event.dataTransfer.files))}function killEvent(e){e.stopPropagation();e.preventDefault();return false}function addDragDropListener(element,callback){element.addEventListener("dragenter",killEvent,false);element.addEventListener("dragover",killEvent,false);element.addEventListener("drop",handleDrop.bind(undefined,callback),false)}module.exports=addDragDropListener},{}],"/Users/bfred/Web/projects/cropper/node_modules/pica/index.js":[function(require,module,exports){"use strict";var WORKER=typeof window!=="undefined"&&"Worker"in window;if(WORKER){try{var wkr=require("webworkify")(function(){});wkr.terminate()}catch(__){WORKER=false}}var resize=require("./lib/resize");var resizeWorker=require("./lib/resize_worker");function _class(obj){return Object.prototype.toString.call(obj)}function isFunction(obj){return _class(obj)==="[object Function]"}function resizeBuffer(options,callback){var wr;var _opts={src:options.src,dest:null,width:options.width|0,height:options.height|0,toWidth:options.toWidth|0,toHeight:options.toHeight|0,quality:options.quality,alpha:options.alpha,unsharpAmount:options.unsharpAmount,unsharpThreshold:options.unsharpThreshold};if(WORKER&&exports.WW){wr=require("webworkify")(resizeWorker);wr.onmessage=function(ev){var i,l,dest=options.dest,output=ev.data.output;if(dest){if(dest.set){dest.set(output)}else{for(i=0,l=output.length;i<l;i++){dest[i]=output[i]}}}callback(ev.data.err,output);wr.terminate()};if(options.transferable){wr.postMessage(_opts,[options.src.buffer])}else{wr.postMessage(_opts)}return wr}_opts.dest=options.dest;resize(_opts,callback);return undefined}function resizeCanvas(from,to,options,callback){var w=from.width,h=from.height,w2=to.width,h2=to.height;if(isFunction(options)){callback=options;options={}}if(!isNaN(options)){options={quality:options,alpha:false}}var ctxTo=to.getContext("2d");var imageDataTo=ctxTo.getImageData(0,0,w2,h2);var _opts={src:from.getContext("2d").getImageData(0,0,w,h).data,dest:imageDataTo.data,width:from.width,height:from.height,toWidth:to.width,toHeight:to.height,quality:options.quality,alpha:options.alpha,unsharpAmount:options.unsharpAmount,unsharpThreshold:options.unsharpThreshold,transferable:true};return resizeBuffer(_opts,function(err){if(err){callback(err);return}ctxTo.putImageData(imageDataTo,0,0);callback()})}exports.resizeBuffer=resizeBuffer;exports.resizeCanvas=resizeCanvas;exports.WW=WORKER},{"./lib/resize":"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/resize.js","./lib/resize_worker":"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/resize_worker.js",webworkify:"/Users/bfred/Web/projects/cropper/node_modules/pica/node_modules/webworkify/index.js"}],"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/pure/blur.js":[function(require,module,exports){"use strict";var _blurKernel=new Uint8Array([1,2,1,2,4,2,1,2,1]);var _bkWidth=Math.floor(Math.sqrt(_blurKernel.length));var _bkHalf=Math.floor(_bkWidth/2);var _bkWsum=0;for(var wc=0;wc<_blurKernel.length;wc++){_bkWsum+=_blurKernel[wc]}function blurPoint(gs,x,y,srcW,srcH){var bx,by,sx,sy,w,wsum,br;var bPtr=0;var blurKernel=_blurKernel;var bkHalf=_bkHalf;wsum=0;br=0;if(x>=bkHalf&&y>=bkHalf&&x+bkHalf<srcW&&y+bkHalf<srcH){for(by=0;by<3;by++){for(bx=0;bx<3;bx++){sx=x+bx-bkHalf;sy=y+by-bkHalf;br+=gs[sx+sy*srcW]*blurKernel[bPtr++]}}return(br-br%_bkWsum)/_bkWsum}for(by=0;by<3;by++){for(bx=0;bx<3;bx++){sx=x+bx-bkHalf;sy=y+by-bkHalf;if(sx>=0&&sx<srcW&&sy>=0&&sy<srcH){w=blurKernel[bPtr];wsum+=w;br+=gs[sx+sy*srcW]*w}bPtr++}}return(br-br%wsum)/wsum|0}function blur(src,srcW,srcH){var x,y,output=new Uint16Array(src.length);for(x=0;x<srcW;x++){for(y=0;y<srcH;y++){output[y*srcW+x]=blurPoint(src,x,y,srcW,srcH)}}return output}module.exports=blur},{}],"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/pure/resize.js":[function(require,module,exports){"use strict";var unsharp=require("./unsharp");var FIXED_FRAC_BITS=14;var FIXED_FRAC_VAL=1<<FIXED_FRAC_BITS;var FILTER_INFO=[{win:.5,filter:function(x){return x>=-.5&&x<.5?1:0}},{win:1,filter:function(x){if(x<=-1||x>=1){return 0}if(x>-1.1920929e-7&&x<1.1920929e-7){return 1}var xpi=x*Math.PI;return Math.sin(xpi)/xpi*(.54+.46*Math.cos(xpi/1))}},{win:2,filter:function(x){if(x<=-2||x>=2){return 0}if(x>-1.1920929e-7&&x<1.1920929e-7){return 1}var xpi=x*Math.PI;return Math.sin(xpi)/xpi*Math.sin(xpi/2)/(xpi/2)}},{win:3,filter:function(x){if(x<=-3||x>=3){return 0}if(x>-1.1920929e-7&&x<1.1920929e-7){return 1}var xpi=x*Math.PI;return Math.sin(xpi)/xpi*Math.sin(xpi/3)/(xpi/3)}}];function clampTo8(i){return i<0?0:i>255?255:i}function toFixedPoint(num){return Math.floor(num*FIXED_FRAC_VAL)}function createFilters(quality,srcSize,destSize){var filterFunction=FILTER_INFO[quality].filter;var scale=destSize/srcSize;var scaleInverted=1/scale;var scaleClamped=Math.min(1,scale);var srcWindow=FILTER_INFO[quality].win/scaleClamped;var destPixel,srcPixel,srcFirst,srcLast,filterElementSize,floatFilter,fxpFilter,total,fixedTotal,pxl,idx,floatVal,fixedVal;var leftNotEmpty,rightNotEmpty,filterShift,filterSize;var maxFilterElementSize=Math.floor((srcWindow+1)*2);var packedFilter=new Int16Array((maxFilterElementSize+2)*destSize);var packedFilterPtr=0;for(destPixel=0;destPixel<destSize;destPixel++){srcPixel=(destPixel+.5)*scaleInverted;srcFirst=Math.max(0,Math.floor(srcPixel-srcWindow));srcLast=Math.min(srcSize-1,Math.ceil(srcPixel+srcWindow));filterElementSize=srcLast-srcFirst+1;floatFilter=new Float32Array(filterElementSize);fxpFilter=new Int16Array(filterElementSize);total=0;for(pxl=srcFirst,idx=0;pxl<=srcLast;pxl++,idx++){floatVal=filterFunction((pxl+.5-srcPixel)*scaleClamped);total+=floatVal;floatFilter[idx]=floatVal}fixedTotal=0;for(idx=0;idx<floatFilter.length;idx++){fixedVal=toFixedPoint(floatFilter[idx]/total);fixedTotal+=fixedVal;fxpFilter[idx]=fixedVal}fxpFilter[destSize>>1]+=toFixedPoint(1)-fixedTotal;leftNotEmpty=0;while(leftNotEmpty<fxpFilter.length&&fxpFilter[leftNotEmpty]===0){leftNotEmpty++}if(leftNotEmpty<fxpFilter.length){rightNotEmpty=fxpFilter.length-1;while(rightNotEmpty>0&&fxpFilter[rightNotEmpty]===0){rightNotEmpty--}filterShift=srcFirst+leftNotEmpty;filterSize=rightNotEmpty-leftNotEmpty+1;packedFilter[packedFilterPtr++]=filterShift;packedFilter[packedFilterPtr++]=filterSize;packedFilter.set(fxpFilter.subarray(leftNotEmpty,rightNotEmpty+1),packedFilterPtr);packedFilterPtr+=filterSize}else{packedFilter[packedFilterPtr++]=0;packedFilter[packedFilterPtr++]=0}}return packedFilter}function convolveHorizontally(src,dest,srcW,srcH,destW,filters){var r,g,b,a;var filterPtr,filterShift,filterSize;var srcPtr,srcY,destX,filterVal;var srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){filterPtr=0;for(destX=0;destX<destW;destX++){filterShift=filters[filterPtr++];filterSize=filters[filterPtr++];srcPtr=srcOffset+filterShift*4|0;r=g=b=a=0;for(;filterSize>0;filterSize--){filterVal=filters[filterPtr++];a=a+filterVal*src[srcPtr+3]|0;b=b+filterVal*src[srcPtr+2]|0;g=g+filterVal*src[srcPtr+1]|0;r=r+filterVal*src[srcPtr]|0;srcPtr=srcPtr+4|0}dest[destOffset+3]=clampTo8(a>>14);dest[destOffset+2]=clampTo8(b>>14);dest[destOffset+1]=clampTo8(g>>14);dest[destOffset]=clampTo8(r>>14);destOffset=destOffset+srcH*4|0}destOffset=(srcY+1)*4|0;srcOffset=(srcY+1)*srcW*4|0}}function convolveVertically(src,dest,srcW,srcH,destW,filters){var r,g,b,a;var filterPtr,filterShift,filterSize;var srcPtr,srcY,destX,filterVal;var srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){filterPtr=0;for(destX=0;destX<destW;destX++){filterShift=filters[filterPtr++];filterSize=filters[filterPtr++];srcPtr=srcOffset+filterShift*4|0;r=g=b=a=0;for(;filterSize>0;filterSize--){filterVal=filters[filterPtr++];a=a+filterVal*src[srcPtr+3]|0;b=b+filterVal*src[srcPtr+2]|0;g=g+filterVal*src[srcPtr+1]|0;r=r+filterVal*src[srcPtr]|0;srcPtr=srcPtr+4|0}dest[destOffset+3]=clampTo8(a>>14);dest[destOffset+2]=clampTo8(b>>14);dest[destOffset+1]=clampTo8(g>>14);dest[destOffset]=clampTo8(r>>14);destOffset=destOffset+srcH*4|0}destOffset=(srcY+1)*4|0;srcOffset=(srcY+1)*srcW*4|0}}function resetAlpha(dst,width,height){var ptr=3,len=width*height*4|0;while(ptr<len){dst[ptr]=255;ptr=ptr+4|0}}function resize(options){var src=options.src;var srcW=options.width;var srcH=options.height;var destW=options.toWidth;var destH=options.toHeight;var dest=options.dest||new Uint8Array(destW*destH*4);var quality=options.quality===undefined?3:options.quality;var alpha=options.alpha||false;var unsharpAmount=options.unsharpAmount===undefined?0:options.unsharpAmount|0;var unsharpThreshold=options.unsharpThreshold===undefined?0:options.unsharpThreshold|0;if(srcW<1||srcH<1||destW<1||destH<1){return[]}var filtersX=createFilters(quality,srcW,destW),filtersY=createFilters(quality,srcH,destH);var tmp=new Uint8Array(destW*srcH*4);convolveHorizontally(src,tmp,srcW,srcH,destW,filtersX);convolveVertically(tmp,dest,srcH,destW,destH,filtersY);if(!alpha){resetAlpha(dest,destW,destH)}if(unsharpAmount){unsharp(dest,destW,destH,unsharpAmount,1,unsharpThreshold)}return dest}module.exports=resize},{"./unsharp":"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/pure/unsharp.js"}],"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/pure/unsharp.js":[function(require,module,exports){"use strict";var blur=require("./blur");function clampTo8(i){return i<0?0:i>255?255:i}function greyscale(src,srcW,srcH){var size=srcW*srcH;var result=new Uint16Array(size);var i,srcPtr;for(i=0,srcPtr=0;i<size;i++){result[i]=src[srcPtr+2]*7471+src[srcPtr+1]*38470+src[srcPtr]*19595>>>8;srcPtr=srcPtr+4|0}return result}function unsharp(src,srcW,srcH,amount,radius,threshold){var x,y,c,diff=0,corr,srcPtr;var AMOUNT_NORM=Math.floor(amount*256/50);var gs=greyscale(src,srcW,srcH);var blured=blur(gs,srcW,srcH,1);var fpThreshold=threshold<<8;var gsPtr=0;for(y=0;y<srcH;y++){for(x=0;x<srcW;x++){diff=gs[gsPtr]-blured[gsPtr];if(Math.abs(diff)>fpThreshold){corr=65536+(diff*AMOUNT_NORM>>8);srcPtr=gsPtr*4;c=src[srcPtr];src[srcPtr++]=clampTo8(c*corr>>16);c=src[srcPtr];src[srcPtr++]=clampTo8(c*corr>>16);c=src[srcPtr];src[srcPtr]=clampTo8(c*corr>>16)}gsPtr++}}}module.exports=unsharp},{"./blur":"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/pure/blur.js"}],"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/resize.js":[function(require,module,exports){"use strict";var resize=require("./pure/resize");module.exports=function(options,callback){var output=resize(options);callback(null,output)}},{"./pure/resize":"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/pure/resize.js"}],"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/resize_worker.js":[function(require,module,exports){"use strict";module.exports=function(self){var resize=require("./resize");self.onmessage=function(ev){resize(ev.data,function(err,output){if(err){self.postMessage({err:err});return}self.postMessage({output:output},[output.buffer])})}}},{"./resize":"/Users/bfred/Web/projects/cropper/node_modules/pica/lib/resize.js"}],"/Users/bfred/Web/projects/cropper/node_modules/pica/node_modules/webworkify/index.js":[function(require,module,exports){var bundleFn=arguments[3];var sources=arguments[4];var cache=arguments[5];var stringify=JSON.stringify;module.exports=function(fn){var keys=[];var wkey;var cacheKeys=Object.keys(cache);for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];if(cache[key].exports===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key}sources[wkey]=[Function(["require","module","exports"],"("+fn+")(self)"),wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var scache={};scache[wkey]=wkey;sources[skey]=[Function(["require"],"require("+stringify(wkey)+")(self)"),scache];var src="("+bundleFn+")({"+Object.keys(sources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])";return new Worker(window.URL.createObjectURL(new Blob([src],{type:"text/javascript"})))}},{}]},{},["./app/scripts/main.js"]);